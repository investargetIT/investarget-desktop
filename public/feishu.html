<!DOCTYPE html>
<html dir="ltr" mozdisallowselectionprint moznomarginboxes>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="google" content="notranslate">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>文档预览</title>

    
    <script src="https://lf1-cdn-tos.bytescm.com/goofy/locl/lark/external_js_sdk/h5-js-sdk-1.0.11.js"></script>
    <script src="lib/sha1.min.js"></script>

    <style>
      body {
        margin: 0;
        padding: 0;
      }
    </style>
  </head>

  <body>
    <!-- <div style="font-size: 24px;line-height: 28px;">飞书云文档组件</div> -->
    <div id="feishu"></div>
    <!-- <script src="feishu/feishu.js"></script> -->
    <script>
       const app_id = 'cli_a244e8cb7e64100e';
       const app_secret = 'Cz8osyGyWqPj9V9Xc6LWJhEUb0bfWVs1';

       // call endpoint to get app_access_token
       const app_access_token = 't-6f497a3ccea22588a3fd261d412ca5216c434528';

       const redirect_url = 'http://localhost:8000/feishu.html';
       const auth_url = `https://open.feishu.cn/open-apis/authen/v1/index?app_id=${app_id}&redirect_uri=${encodeURIComponent(redirect_url)}&state=RANDOMSTATE`;
       console.log('auth url', auth_url);
       const code = '17h9IPP0t3G828xtmqhWtg4g73P1k5CHUO004kQaw8kh';
       
       const user_access_token = 'u-00HD.UVHp729eBA3652azz4g5zr1k5Kzr200ghAawdhg';

       // call endpoint to get jsapi_ticket
       const jsapi_ticket = '986bdfa8bd3c8f87f15dbbf955069220644822cf';

       const timestamp = Date.now().toString();
       const noncestr = 'Y7a8KkqX041bsSwT';
       const url = 'http://localhost:8000/feishu.html1';
       const str = `jsapi_ticket=${jsapi_ticket}&noncestr=${noncestr}&timestamp=${timestamp}&url=${url}`;
       console.log('sha', sha1(''), Date.now());
        window.webComponent.config({
          openId: 'ou_afde3ae745600f6dbc3a3b2d5dfb11c0',    // 当前登录用户的open id，要确保与生成 signature 使用的 user_access_token 相对应，使用 app_access_token 时此项不填。注意：仅云文档组件可使用app_access_token
          signature: sha1(str), // 签名
          appId: app_id,     // 应用 appId
          timestamp: timestamp, // 时间戳（毫秒）
          nonceStr: noncestr,  // 随机字符串
          url,       // 第3步参与加密计算的url
          jsApiList: ['DocsComponent'], // 指定要使用的组件列表，请根据对应组件的开发文档填写。如云文档组件，填写['DocsComponent']
          lang: 'zh',      // 指定组件的国际化语言：en-英文、zh-中文、ja-日文
        }).then(res => {
          // 可以在这里进行组件动态渲染
          console.log('res', res);

          // window.addOpenDocDynamical = function () {
            // 动态渲染，返回组件实例。
            myComponent = window.webComponent.render(
              'DocsComponent',
              { //组件参数
                src: 'https://t3ionjsf4i.feishu.cn/sheets/shtcnMXy001FqtNxclxQNf7gnYb',
                minHeight: window.innerHeight - 48,
                width: '100%',
              },
              document.querySelector('#feishu'), // 将组件挂在到哪个元素上
            )
          // }
          window.removeOpenDocDynamical = function () {
            // 销毁组件
            myComponent.unmount()
          }

        })

        window.webComponent.onAuthError(function (error) {
          console.error('auth error callback', error)
        })
    </script>
  </body>
</html>

